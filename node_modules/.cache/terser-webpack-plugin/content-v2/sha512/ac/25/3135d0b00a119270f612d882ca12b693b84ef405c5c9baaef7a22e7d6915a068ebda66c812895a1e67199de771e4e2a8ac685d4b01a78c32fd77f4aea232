{"code":"!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p=\"\",i(i.s=5)}([function(t,e,i){var n=i(1);\"string\"==typeof n&&(n=[[t.i,n,\"\"]]);var r={hmr:!0,transform:void 0,insertInto:void 0};i(3)(n,r);n.locals&&(t.exports=n.locals)},function(t,e,i){(t.exports=i(2)(!1)).push([t.i,\"\\n/* module */\\n.flowchart-father {\\n    box-sizing: border-box;\\n    -webkit-touch-callout: none;\\n    -webkit-user-select: none;\\n    -khtml-user-select: none;\\n    -moz-user-select: none;\\n    -ms-user-select: none;\\n    user-select: none;\\n}\\n.basemodule {\\n    z-index: 2;\\n}\\n.module-delete {\\n    display: none;\\n    position: absolute;\\n    right: -32px;\\n    top: 50%;\\n    transform: translateY(-50%);\\n    width: 34px;\\n    color: #dfdfdf;\\n    font-size: 23px;\\n    background-color: transparent;\\n    text-align: right;\\n}\\n.module-delete:hover {\\n    cursor: pointer;\\n}\\n.basemodule:hover .module-delete {\\n    display: block;\\n}\\n.basemodule:hover {\\n    cursor: move;\\n}\\n/* 模块在拖拽时层级最高 */ \\n.basemodule.isMoving {\\n    z-index: 100;\\n}\\n\\n\\n\\n/* 开始和结束模块 */\\n.last-module .title-wraper,.first-module .title-wraper{\\n    width: 90px;\\n    background: #fff;\\n    border: 1px solid #dadada;\\n    color: #484848;\\n}\\n.last-module .hasLeftSepa::before,\\n.first-module .hasLeftSepa::before{\\n    background-color: #e0e0e0; \\n}\\n.hasLeftMargin {\\n    margin-left: 10px;\\n}\\n\\n/* module children */\\n.hasChildren .title-wraper {\\n    border-bottom-right-radius: 0px;\\n    border-bottom-left-radius: 0px;\\n}\\n.children-wraper {\\n    border: 1px solid #d6d6d6;\\n    border-top: 0px;\\n    border-bottom-left-radius: 4px;\\n    border-bottom-right-radius: 4px;\\n}\\n.children-wraper .title-text {\\n    max-width: 136px;\\n}\\n\\n.children-wraper .basemodule .title-wraper {\\n    width: 160px;\\n    background-color: rgba(250, 250, 250, 0.8);\\n    color: #484848;\\n}\\n.children-wraper .basemodule + .basemodule {\\n    border-top: 1px solid #d6d6d6;\\n}\\n.children-wraper .basemodule:last-child .title-wraper {\\n    border-bottom-left-radius: 4px;\\n    border-bottom-right-radius: 4px;\\n}\\n\\n\\n/* module-title */\\n.title-wraper {\\n    position: relative;\\n    display: flex;\\n    align-items: center;\\n    width: 162px;\\n    height: 36px;\\n    color: #fff;\\n    background-color: rgba(18, 210, 203, 0.9);\\n    font-size: 14px;\\n    border-radius: 4px;\\n    -webkit-touch-callout: none;\\n    -webkit-user-select: none;\\n    -khtml-user-select: none;\\n    -moz-user-select: none;\\n    -ms-user-select: none;\\n    user-select: none;\\n}\\n\\ni.ivricon {\\n    display: inline-block;\\n    text-align: center;\\n    width: 40px;\\n    font-size: 20px;\\n    cursor: pointer;\\n}\\n.title-text {\\n    position: relative;\\n    padding-left: 6px;\\n    display: inline-block;\\n    max-width: 110px;\\n    font-size: 14px;\\n    line-height: 26px;\\n    overflow: hidden;\\n    text-overflow: ellipsis;\\n    white-space: nowrap;\\n}\\n.hasLeftSepa::before {\\n    position: absolute;\\n    top: 50%;\\n    transform: translateY(-50%);\\n    left: 0px;\\n    content: '';\\n    height: 26px;\\n    width: 1px;\\n    background-color: #fff; \\n}\\n\\n\\n\\n/* module 拖拽节点 */\\n.dragableRect {\\n    content: '';\\n    position: absolute;\\n    right: -6px;\\n    top: 12px;\\n    width: 12px;\\n    height: 12px;\\n    border-radius: 100%;\\n    border: 1px solid #dddddd;\\n    background-color: rgba(255, 255, 255, 0.8);\\n    z-index: 1;\\n}\\n.dragableRect.leftRect {\\n    left: -7px;\\n    background-color: #dddddd;\\n}\\n.dragableRect.rightRect.connected {\\n    cursor: default;\\n}\\n\\n.dragableRect:hover {\\n    cursor: pointer;\\n}\\n\\n/* 拖拽模块时元素显示 */\\n#copyMove {\\n    position: absolute;\\n    left: 0px;\\n    top: -2000px;\\n    opacity: 0;\\n    pointer-events: none;\\n}\\n\\n/* 选中线后删除图标 */\\ni.delete-line {\\n    position: absolute;\\n    width: 23px;\\n    height: 23px;\\n    font-size: 23px;\\n    cursor: pointer;\\n    color: #12d2cb;\\n    z-index: 102;\\n}\\n\\n/* 总节点展示 */\\n.nodes {\\n    position: fixed;\\n    left: 50%;\\n    top: 430px;\\n    z-index: 0;\\n    transform: translateX(-50%);\\n    pointer-events: none;\\n    color: #2c333b;\\n    font-size: 14px;\\n    -webkit-touch-callout: none;\\n    -webkit-user-select: none;\\n    -khtml-user-select: none;\\n    -moz-user-select: none;\\n    -ms-user-select: none;\\n    user-select: none;\\n}\\n.all-nodes,\\n.connected-nodes {\\n    display: inline-block;\\n    position: relative;\\n}\\n.connected-nodes {\\n    margin-left: 46px; \\n}\\n.connected-nodes::before,\\n.all-nodes::before {\\n    position: absolute;\\n    content: \\\"\\\";\\n    box-sizing: border-box;\\n    width: 12px;\\n    height: 12px;\\n    top: 50%;\\n    left: -20px;\\n    transform: translateY(-50%);\\n    border: 1px solid #c9c9c9;\\n    border-radius: 100%;\\n}\\n\\n.all-nodes::before {\\n    border-color: #12d2cb;\\n    background-color: #fff;\\n}\\n.connected-nodes::before {\\n    border-color: #12d2cb;\\n    background-color: #12d2cb;\\n}\\n\\n\\n/* 页面button */\\n.button {\\n    display: inline-block;\\n    border: 1px solid;\\n    width: 350px;\\n    line-height: 2;\\n    background-color: lightblue;\\n    text-align: center;\\n}\",\"\"])},function(t,e,i){\"use strict\";t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var i=function(t,e){var i=t[1]||\"\",n=t[3];if(!n)return i;if(e&&\"function\"==typeof btoa){var r=(s=n,\"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,\"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+\" */\"),o=n.sources.map(function(t){return\"/*# sourceURL=\"+n.sourceRoot+t+\" */\"});return[i].concat(o).concat([r]).join(\"\\n\")}var s;return[i].join(\"\\n\")}(e,t);return e[2]?\"@media \"+e[2]+\"{\"+i+\"}\":i}).join(\"\")},e.i=function(t,i){\"string\"==typeof t&&(t=[[null,t,\"\"]]);for(var n={},r=0;r<this.length;r++){var o=this[r][0];null!=o&&(n[o]=!0)}for(r=0;r<t.length;r++){var s=t[r];null!=s[0]&&n[s[0]]||(i&&!s[2]?s[2]=i:i&&(s[2]=\"(\"+s[2]+\") and (\"+i+\")\"),e.push(s))}},e}},function(t,e,i){var n,r,o={},s=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===r&&(r=n.apply(this,arguments)),r}),a=function(t){var e={};return function(t,i){if(\"function\"==typeof t)return t();if(void 0===e[t]){var n=function(t,e){return e?e.querySelector(t):document.querySelector(t)}.call(this,t,i);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}}(),h=null,l=0,c=[],d=i(4);function f(t,e){for(var i=0;i<t.length;i++){var n=t[i],r=o[n.id];if(r){r.refs++;for(var s=0;s<r.parts.length;s++)r.parts[s](n.parts[s]);for(;s<n.parts.length;s++)r.parts.push(b(n.parts[s],e))}else{var a=[];for(s=0;s<n.parts.length;s++)a.push(b(n.parts[s],e));o[n.id]={id:n.id,refs:1,parts:a}}}}function u(t,e){for(var i=[],n={},r=0;r<t.length;r++){var o=t[r],s=e.base?o[0]+e.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};n[s]?n[s].parts.push(a):i.push(n[s]={id:s,parts:[a]})}return i}function p(t,e){var i=a(t.insertInto);if(!i)throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.\");var n=c[c.length-1];if(\"top\"===t.insertAt)n?n.nextSibling?i.insertBefore(e,n.nextSibling):i.appendChild(e):i.insertBefore(e,i.firstChild),c.push(e);else if(\"bottom\"===t.insertAt)i.appendChild(e);else{if(\"object\"!=typeof t.insertAt||!t.insertAt.before)throw new Error(\"[Style Loader]\\n\\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\\n Must be 'top', 'bottom', or Object.\\n (https://github.com/webpack-contrib/style-loader#insertat)\\n\");var r=a(t.insertAt.before,i);i.insertBefore(e,r)}}function g(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=c.indexOf(t);e>=0&&c.splice(e,1)}function v(t){var e=document.createElement(\"style\");if(void 0===t.attrs.type&&(t.attrs.type=\"text/css\"),void 0===t.attrs.nonce){var n=function(){0;return i.nc}();n&&(t.attrs.nonce=n)}return w(e,t.attrs),p(t,e),e}function w(t,e){Object.keys(e).forEach(function(i){t.setAttribute(i,e[i])})}function b(t,e){var i,n,r,o;if(e.transform&&t.css){if(!(o=\"function\"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=o}if(e.singleton){var s=l++;i=h||(h=v(e)),n=m.bind(null,i,s,!1),r=m.bind(null,i,s,!0)}else t.sourceMap&&\"function\"==typeof URL&&\"function\"==typeof URL.createObjectURL&&\"function\"==typeof URL.revokeObjectURL&&\"function\"==typeof Blob&&\"function\"==typeof btoa?(i=function(t){var e=document.createElement(\"link\");return void 0===t.attrs.type&&(t.attrs.type=\"text/css\"),t.attrs.rel=\"stylesheet\",w(e,t.attrs),p(t,e),e}(e),n=function(t,e,i){var n=i.css,r=i.sourceMap,o=void 0===e.convertToAbsoluteUrls&&r;(e.convertToAbsoluteUrls||o)&&(n=d(n));r&&(n+=\"\\n/*# sourceMappingURL=data:application/json;base64,\"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+\" */\");var s=new Blob([n],{type:\"text/css\"}),a=t.href;t.href=URL.createObjectURL(s),a&&URL.revokeObjectURL(a)}.bind(null,i,e),r=function(){g(i),i.href&&URL.revokeObjectURL(i.href)}):(i=v(e),n=function(t,e){var i=e.css,n=e.media;n&&t.setAttribute(\"media\",n);if(t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}.bind(null,i),r=function(){g(i)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else r()}}t.exports=function(t,e){if(\"undefined\"!=typeof DEBUG&&DEBUG&&\"object\"!=typeof document)throw new Error(\"The style-loader cannot be used in a non-browser environment\");(e=e||{}).attrs=\"object\"==typeof e.attrs?e.attrs:{},e.singleton||\"boolean\"==typeof e.singleton||(e.singleton=s()),e.insertInto||(e.insertInto=\"head\"),e.insertAt||(e.insertAt=\"bottom\");var i=u(t,e);return f(i,e),function(t){for(var n=[],r=0;r<i.length;r++){var s=i[r];(a=o[s.id]).refs--,n.push(a)}t&&f(u(t,e),e);for(r=0;r<n.length;r++){var a;if(0===(a=n[r]).refs){for(var h=0;h<a.parts.length;h++)a.parts[h]();delete o[a.id]}}}};var x,y=(x=[],function(t,e){return x[t]=e,x.filter(Boolean).join(\"\\n\")});function m(t,e,i,n){var r=i?\"\":n.css;if(t.styleSheet)t.styleSheet.cssText=y(e,r);else{var o=document.createTextNode(r),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(o,s[e]):t.appendChild(o)}}},function(t,e){t.exports=function(t){var e=\"undefined\"!=typeof window&&window.location;if(!e)throw new Error(\"fixUrls requires window.location\");if(!t||\"string\"!=typeof t)return t;var i=e.protocol+\"//\"+e.host,n=i+e.pathname.replace(/\\/[^\\/]*$/,\"/\");return t.replace(/url\\s*\\(((?:[^)(]|\\((?:[^)(]+|\\([^)(]*\\))*\\))*)\\)/gi,function(t,e){var r,o=e.trim().replace(/^\"(.*)\"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});return/^(#|data:|http:\\/\\/|https:\\/\\/|file:\\/\\/\\/|\\s*$)/i.test(o)?t:(r=0===o.indexOf(\"//\")?o:0===o.indexOf(\"/\")?i+o:n+o.replace(/^\\.\\//,\"\"),\"url(\"+JSON.stringify(r)+\")\")})}},function(t,e,i){\"use strict\";function n(t={}){var e={feId:\"line\"+(new Date).getTime(),originX:0,originY:0,isEnd:!1,lineRange:8,themeColor:\"#12d2cb\"};Object.assign(this,e,t)}i.r(e),n.prototype.setPoint=function(t={}){this.sx=t.sx||this.sx,this.sy=t.sy||this.sy,t.start&&(this.start=t.start),t.end&&(this.end=t.end),this.start&&this.end&&(this.isEnd=!0,this.styleEndPonit())},n.prototype.styleEndPonit=function(){this.isEnd?$(\"#\"+this.end.feId+\">.title-wraper>.dragableRect.end,#\"+this.start.feId+\">.title-wraper>.dragableRect.start\").addClass(\"connected\"):$(\"#\"+this.end.feId+\">.title-wraper>.dragableRect.end\").removeClass(\"connected\")},n.prototype.update=function(t={}){\"start\"===t.dir?(this.sx=t.x||this.sx,this.sy=t.y||this.sy):\"end\"===t.dir&&(this.ex=t.x||this.ex,this.ey=t.y||this.ey),this.start&&this.end&&(this.isEnd=!0,this.styleEndPonit())},n.prototype.reconnected=function(t,e){this.isEnd=!1,this.focus=!1;var i=this;e.find(function(t){return t.feId!=i.feId&&t.end.feId===i.end.feId})||this.styleEndPonit(),$(\"#\"+this.start.feId+\" .start\").removeClass(\"connected\"),this[t]=null},n.prototype.lineCoordinate=function(t={},e){var i=t.scrollLeft||0,n=t.scrollTop||0;if(this.start){var r=$(`#${this.start.feId} .start`)[0],o=$(r).offset()||{};this.sx=o.left-this.originX+i+e/2,this.sy=o.top-this.originY+n+e/2}if(this.end){var s=$(`#${this.end.feId} .end`)[0];o=$(s).offset();this.ex=o.left-this.originX+i+e/2,this.ey=o.top-this.originY+n+e/2}},n.prototype.isOnline=function(t,e){var i=Math.min(this.ey,this.sy),n=Math.max(this.ey,this.sy);if(Math.abs(this.ex-this.sx)<=this.lineRange&&t+this.lineRange>this.ex&&t-this.lineRange<this.ex&&e>=i&&e<=n)return!0;var r=(this.ey-this.sy)/(this.ex-this.sx),o=this.ey-r*this.ex,s=Math.min(this.ex,this.sx),a=Math.max(this.ex,this.sx);return r*t+o+this.lineRange>e&&r*t+o-this.lineRange<e&&t>=s&&t<=a},n.prototype.destroy=function(){this.isEnd=!0,this.isDestroy=!0},n.prototype._lineHover=function(t){console.log(\"line hover\")},n.prototype._lineClick=function(t){console.log(\"line click\")};var r=n;function o(){var t=$(\"<canvas></canvas>\")[0].getContext(\"2d\");return(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}function s(t,e,i){var n=(i.x-e.x)*(t.x-e.x)+(i.y-e.y)*(t.y-e.y);if(n<=0)return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));var r=Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2);if(n>=r)return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2));var o=n/r,s=e.x+(i.x-e.x)*o,a=e.y+(i.y-e.y)*o;return Math.sqrt(Math.pow(t.x-s,2)+Math.pow(a-t.y,2))}function a(t={}){var e=o();this.isLast=!1,this.isFirst=!1,this.hasDelete=!1,this.hasSetting=!0,this.ratio=e,this.text=\"标题\",this.deleteWidth=10,this.canvasX=0,this.canvasY=0,this.x=0,this.y=0,this.containerHeight=0,this.feType=\"normal\",this.fontSize=14,this.textX=5,this.color=\"#333\",this.titleIcon=\"icon-shuxingtushouqi\",this.position=\"absolute\",this.toCenter=!1,Object.assign(this,t),this.className=t.className?t.className:\" flowBaseModule\",this.fontSize=this.fontSize*e,this.text=t.text?t.text:this.isFirst?\"开始\":this.isLast?\"结束\":\"标题\",this.textX=this.textX*e,this.$icon=void 0,this.$title=void 0,this.isLast?(this.canbeStart=!1,this.className+=\" last-module\"):void 0!==t.canbeStart?this.canbeStart=t.canbeStart:this.canbeStart=!0,this.isFirst?(this.canbeEnd=!1,this.className+=\" first-module\"):void 0!==t.canbeEnd?this.canbeEnd=t.canbeEnd:this.canbeEnd=!0,this.canDrag=void 0===t.canDrag||t.canDrag,this.font=`${this.fontSize}px Microsoft Yahei`,this.textY=this.height*this.ratio-(this.height*this.ratio-this.fontSize)/2}function h(t={}){this.canbeEnd=!0,this.canbeStart=!1,this.hasSetting=!0,this.childrenGap=10,this.feType=\"branchmodule\",this.children=[],this.className=\"hasChildren\",Object.assign(this,t),this.$icon=void 0,this.$title=void 0}function l(t={}){this.className=\"childModule\",this.canbeEnd=!1,this.canbeStart=!0,this.hasDelete=!1,this.hasSetting=!1,this.canDrag=!1,this.gap=10,this.width=80,this.height=20,this.feType=\"branch\",this.position=\"relative\",this.titleIcon=\"\";var e=Object.assign(this,t);e.width=e.parentwidth-2*e.gap,e.height=e.parentHeight-e.gap,Object.assign(this,e),this.$icon=void 0,this.$title=void 0}function c(t={}){this.feType=\"specialBranch\",Object.assign(this,t)}function d(t={}){this.lines=[],this.modules=[],this.ratio=o(),this.width=t.canvasWidth||1400,this.height=t.canvasHeight||1e3,this.themeColor=\"#12d2cb\",this.creatingModule=null,this.rectWidth=12,this.showNodesWraper=!0,this.deleteIcon=\"icon-IVR-shanchu\",this.lineRandomIds=[],this.moduleRandomIds=[],this.clickLineOnModule=!1,this.$wraper=t.wraper?$(t.wraper):$(\"body\");for(var e=0;e<=1e3;e++){if((e=String(e)).length<4)for(var i=4-e.length,n=1;n<=i;n++)e=\"0\"+e;this.lineRandomIds.push(e)}this.moduleRandomIds=this.lineRandomIds.concat([]),this.init(),this.initEvent()}a.prototype.update=function(t){Object.assign(this,t),this.drawModule()},a.prototype.drawModule=function(){var t,e,i;!this.$icon&&this.titleIcon?(t=$('<i class=\"'+this.titleIcon+' ivricon \"></i>'),this.$icon=t,this.titleWraper.append(t)):this.$icon&&this.$icon.removeClass().addClass(this.titleIcon+\" ivricon\"),this.$title?this.$title.html(this.text):(i=this.titleIcon?\"title-text hasLeftSepa\":\"title-text hasLeftMargin\",e=$('<span class=\"'+i+'\" title=\"'+this.text+'\">'+this.text+\"</span>\"),this.$title=e,this.titleWraper.append(e))},a.prototype.init=function(){this.$parent=this.$parent||this.flowchart&&this.flowchart.$parent;var t=this;if(this.rectWidth=this.flowchart.rectWidth,!this.feId){var e=this.flowchart.moduleRandomIds.shift(0);e||console.log(\"模块数量超出最大值1000\"),this.feId=\"module\"+(new Date).getTime()+e}var i=$('<div id=\"'+this.feId+'\" class=\"basemodule '+this.className+'\" style=\"position:'+this.position+'\"></div>');if(this.div=i,this.titleWraper=$('<div class=\"title-wraper\"></div>'),this.canDrag&&(i.mousedown(this.moveStart.bind(this)),$(\"body\").mousemove(this.moveDrag.bind(this)),$(\"body\").mouseup(this.moveEnd.bind(this)),$(\"html\").mouseleave(this.moveEnd.bind(this))),this.hasDelete){var n=this.deleteWidth,r=(this.height,$('<div class=\"module-delete\" id=\"delete'+this.feId+'\"><i class=\"'+this.flowchart.deleteIcon+'\"></i></div>'));this.delete=r,r.on(\"mousedown\",function(e){e.stopPropagation(),t.destroy(),t.flowchart.showNodes()}),this.titleWraper.append(r)}if(this.drawModule(),i.append(this.titleWraper),this.$parent.append(i),this.toCenter){var o=this.width||this.div.width(),s=this.titleHeight||this.titleWraper.height();this.x-=o/2,this.y-=s/2}\"absolute\"===this.position&&i.css({left:this.x+\"px\",top:this.y+\"px\"}),this.createdragableRect()},a.prototype.createdragableRect=function(){var t=this;if(this.canbeEnd){var e=$('<div class=\"dragableRect leftRect end\" draggable=\"true\"></div>');this.titleWraper.append(e)}if(this.canbeStart){var i=$('<div class=\"dragableRect rightRect start\" draggable=\"true\"></div>');this.titleWraper.append(i)}$(\"#\"+this.feId+\">.title-wraper>.dragableRect\").on(\"mousedown\",function(t){t.stopPropagation()}),$(\"body\").on(\"dragstart\",\"#\"+this.feId+\">.title-wraper>.dragableRect\",function(e){e=e.originalEvent;var i=$(e.target).parent().parent().attr(\"id\"),n=$(e.target).hasClass(\"start\")?\"start\":\"end\",o=\"start\"===n?\"end\":\"start\",s=t.flowchart.lines.find(function(t){return t.focus&&t[n].feId===i});if(s&&(s.reconnected(o,t.flowchart.lines),t.flowchart.$deLineIcon.hide()),\"start\"!=n||!$(e.target).hasClass(\"connected\")){if(e.dataTransfer.setDragImage(e.target,0,0),!s){var a;(a=new r({originX:t.flowchart.originX,originY:t.flowchart.originY}))[n]={feId:i},a.lineCoordinate(t.flowchart.scrollDistance(),t.rectWidth),t.flowchart.lines.push(a)}var h=n+\" \"+i;t.flowchart.currentDragStartModuleId=h,e.dataTransfer.effectAllowed=\"copy\",e.dataTransfer.setData(\"dragStartModuleId\",h)}}),this.flowchart.canvas.parent().unbind(\"dragover.BaseModuleNode\"),this.flowchart.canvas.parent().bind(\"dragover.BaseModuleNode\",function(e){(e=e.originalEvent).preventDefault();var i=t.flowchart.currentDragStartModuleId;if(i){var n=i.split(\" \"),r=n[0],o=\"start\"==r?\"end\":\"start\",s=n[1];if(t.flowchart.inScrollParent({x:e.pageX,y:e.pageY},40)?t.stopScroll():t.moveScroll(e),t.flowchart.inScrollParent({x:e.pageX,y:e.pageY})){var a=t.flowchart.scrollDistance(),h=e.pageX-t.flowchart.originX+a.scrollLeft,l=e.pageY-t.flowchart.originY+a.scrollTop;!$(e.target).hasClass(o)||\"start\"===o&&$(e.target).hasClass(\"connected\")?e.dataTransfer.dropEffect=\"none\":e.dataTransfer.dropEffect=\"copy\",t.flowchart.lines.forEach(function(e){e.isEnd||e[r]&&e[r].feId==s&&(e.update({dir:o,x:h,y:l}),e.lineCoordinate(a,t.rectWidth))}),t.flowchart.drawLines(a)}}}),$(\"body\").on(\"dragend\",\"#\"+this.feId+\">.title-wraper>.dragableRect\",function(e){if(e=e.originalEvent,t.isLinging=!1,e.preventDefault(),t.stopScroll(),t.flowchart.lines.find(function(t){return!t.isEnd})){var i=t.flowchart.lines.find(function(e){return!e.isEnd&&(!!(e.start&&t.feId==e.start.feId||e.end&&t.feId==e.end.feId)&&(e.destroy(),!0))});t.flowchart.lines=t.flowchart.lines.filter(function(t){return t!==i}),t.startModuleId=null,t.flowchart.drawLines(),t.flowchart.showNodes()}}),$(\"body\").unbind(\"drop.BaseModuleNode\"),$(\"body\").bind(\"drop.BaseModuleNode\",\".dragableRect\",function(e){(e=e.originalEvent).preventDefault(),t.stopScroll();var i=e.dataTransfer.getData(\"dragStartModuleId\");if(i&&(!$(e.target).hasClass(\"start\")||!$(e.target).hasClass(\"connected\"))){var n=i.split(\" \"),r=(n[1],\"start\"===n[0]?\"end\":\"start\"),o=$(e.target).parent().parent().attr(\"id\"),s=t.flowchart.scrollDistance(),a=t.flowchart&&t.flowchart.modules.find(function(t){return t.feId==o})||{};a.x,a.y,a.height;t.flowchart&&t.flowchart.lines.forEach(function(e){if(!e.isEnd&&!e[r]){var i={};i[r]={feId:o},e.setPoint(i),e.lineCoordinate(s,t.rectWidth);var n=t.flowchart.modules.find(function(t){return t.feId==e.start.feId})||{},a=t.flowchart.modules.find(function(t){return t.feId==e.end.feId})||{};n.feNextId=a.feId,e.isEnd=!0}}),t.flowchart.drawLines(),t.flowchart.showNodes()}})},a.prototype.moveScroll=function(t){if(!this.isAutoScroll){var e={x:t.pageX,y:t.pageY},i=this.flowchart.scrollParent.offsetValue||this.flowchart.scrollParent.offset(),n=this.flowchart.scrollParent.widthValue||this.flowchart.scrollParent.width(),r=this.flowchart.scrollParent.heightValue||this.flowchart.scrollParent.height(),o={dir:\"left\",start:{x:i.left,y:i.top},end:{x:i.left,y:i.top+r}},a={dir:\"right\",start:{x:i.left+n,y:i.top},end:{x:i.left+n,y:i.top+r}},h={dir:\"top\",start:{x:i.left,y:i.top},end:{x:i.left+n,y:i.top}},l={dir:\"bottom\",start:{x:i.left,y:i.top+r},end:{x:i.left+n,y:i.top+r}},c=s(e,o.start,o.end),d=s(e,a.start,a.end),f=s(e,h.start,h.end),u=s(e,l.start,l.end),p=Math.min(c,d,f,u);f===p?this.autoScroll(\"top\"):u===p?this.autoScroll(\"bottom\"):c===p?this.autoScroll(\"left\"):d===p&&this.autoScroll(\"right\")}},a.prototype.autoScroll=function(t){var e=this,i=0,n=0,r=0,o=0;clearInterval(this.timer),this.isAutoScroll=!0,\"top\"===t?this.timer=setInterval(function(){n=e.flowchart.scrollParent.scrollTop(),e.flowchart.scrollParent.scrollTop(Math.max(n-10,0)),(n<=0||!e.isDrag)&&e.stopScroll()},60):\"bottom\"===t?this.timer=setInterval(function(){n=e.flowchart.scrollParent.scrollTop(),r=e.flowchart.scrollParent.heightValue||e.flowchart.scrollParent.height(),(n+r>=e.flowchart.height||!e.isDrag)&&e.stopScroll(),e.flowchart.scrollParent.scrollTop(n+Math.min(10,e.flowchart.height-r))},60):\"left\"===t?this.timer=setInterval(function(){i=e.flowchart.scrollParent.scrollLeft(),e.flowchart.scrollParent.scrollLeft(Math.max(i-10,0)),(i<=0||!e.isDrag)&&e.stopScroll()},60):\"right\"===t&&(this.timer=setInterval(function(){i=e.flowchart.scrollParent.scrollLeft(),o=e.flowchart.scrollParent.widthValue||e.flowchart.scrollParent.width(),(i+o>=e.flowchart.width||!e.isDrag)&&e.stopScroll(),e.flowchart.scrollParent.scrollLeft(i+Math.min(10,e.flowchart.width-o))},60))},a.prototype.stopScroll=function(){clearInterval(this.timer),this.isAutoScroll=!1},a.prototype.moveStart=function(t,e){if(this.flowchart.cancelFocusLine(!0),!$(t.target).is(this.$setting)&&!$(t.target).hasClass(\"dragableRect\")){this.isDrag=!0,this.flowchart.onLineClickBind(t),this.stopScroll(),this.startmouseX=t.pageX,this.startmouseY=t.pageY,this.width=this.width||this.div.width(),this.height=this.height||this.div.height(),this.titleHeight=this.titleHeight||this.div.find(\"> .title-wraper\").height();var i=this.flowchart.scrollDistance();this.followPoint=\"center\"===e?{relativeX:this.width/2,relativeY:this.titleHeight/2}:{relativeX:t.pageX-this.flowchart.originX+i.scrollLeft-this.x,relativeY:t.pageY-this.flowchart.originY+i.scrollTop-this.y},this.div.addClass(\"isMoving\")}},a.prototype.moveEnd=function(t){if(this.isDrag)if(this.isDrag=!1,this.flowchart.clickLineOnModule)this.flowchart.clickLineOnModule=!1;else{this.div.removeClass(\"isMoving\");var e=this.flowchart.scrollDistance();this.height=$(\"#\"+this.feId).height();var i=t.pageX-this.originX+e.scrollLeft,n=t.pageY-this.originY+e.scrollTop;if(this.x<i&&i<this.x+this.width&&this.y<n&&n<this.y+this.height&&this.div.find(\".module-delete\").show(),t.pageX==this.startmouseX&&t.pageY==this.startmouseY&&this.hasSetting){var r=$.Event(\"modulesetting\",{module:Object.assign(this)});this.flowchart.canvas.triggerHandler(r)}this.stopScroll()}},a.prototype.moveDrag=function(t){if(!$(t.target).is(this.$setting)&&!$(t.target).hasClass(\"dragableRect\")&&this.isDrag)if(this.div.find(\".module-delete\").hide(),this.flowchart.inScrollParent({x:t.pageX,y:t.pageY},20)){this.stopScroll();var e=this.flowchart.scrollDistance();this.x=t.pageX+e.scrollLeft-this.flowchart.originX-this.followPoint.relativeX,this.y=t.pageY+e.scrollTop-this.flowchart.originY-this.followPoint.relativeY;var i=this.containerWidth||this.width,n=this.containerHeight||this.height,r=this;this.x<0&&(this.x=0),this.x>0+this.flowchart.width-i&&(this.x=this.flowchart.width-i),this.y<0&&(this.y=0),this.y>0+this.flowchart.height-n&&(this.y=this.flowchart.height-n),this.dragDom(),this.flowchart.lines.forEach(function(t){(t.start.feId===r.feId||t.end.feId===r.feId||r.children&&r.children.find(function(e){return e.feId===t.start.feId}))&&t.lineCoordinate(e,r.rectWidth)}),this.flowchart.drawLines()}else this.moveScroll(t)},a.prototype.contains=function(t,e){var i=document.getElementById(t);return i&&$.contains(i,e)},a.prototype.dragDom=function(){this.div.css({left:this.x,top:this.y})},a.prototype.destroy=function(){var t=this;this.flowchart.deleteRelaLines(this.feId,this.children),this.div.remove(),this.stopScroll(),this.flowchart.modules=this.flowchart.modules.filter(function(e){return e.feId!==t.feId})},h.prototype=new a,h.prototype.initDraw=function(){if(!this.feId){var t=this.flowchart.moduleRandomIds.shift(0);t||console.log(\"模块数量超出最大值1000\"),this.feId=\"containModule\"+(new Date).getTime()+t}this.init(),this.containDraw(),this.addBranch({feId:\"defaultChild\"+(new Date).getTime(),text:\"请添加分支\",canbeStart:!1,isDefaultBranch:!0}).initDraw()},h.prototype.addBranch=function(t){var e=this.children.length&&this.children.find(function(t){return~t.feId.indexOf(\"defaultChild\")});e&&(e.destroy(),this.children=this.children.filter(function(t){return!Boolean(~t.feId.indexOf(\"defaultChild\"))}));var i=new l(t=Object.assign(t,{$parent:this.$content,flowchart:this.flowchart,feParentId:this.feId,parentwidth:this.width,parentHeight:this.height,gap:this.childrenGap,childrenLength:this.children.length,containerId:this.feId}));return this.children.push(i),i},h.prototype.containDraw=function(){this.$content||(this.$content=$('<div class=\"children-wraper\"></div>'),this.div.append(this.$content))},h.prototype.removeChild=function(t){this.children=this.children.filter(function(e){if(e.feId!=t)return e;e.destroy()})},h.prototype.destroy=function(){this.flowchart.deleteRelaLines(this.feId,this.children),this.div.remove();this.flowchart.modules;var t=this;this.flowchart.modules=this.flowchart.modules.filter(function(e){return e.feId!==t.feId}),this.removeChildren()},h.prototype.removeChildren=function(){this.children.forEach(function(t){return t.destroy()}),this.children=[]},l.prototype=new a,l.prototype.initDraw=function(){if(!this.feId){var t=this.flowchart.moduleRandomIds.shift(0);t||console.log(\"模块数量超出最大值1000\"),this.feId=\"childModule\"+(new Date).getTime()+t}this.init()},c.prototype=new h,c.prototype.initDraw=function(){var t,e=this.children.concat([]);this.feId||((t=this.flowchart.moduleRandomIds.shift(0))||console.log(\"模块数量超出最大值1000\"),this.feId=\"specialBranch\"+(new Date).getTime()+t),this.init(),this.containDraw();e=this.children.concat([]);var i=this;this.children=[],e.forEach(function(t){i.addBranch(Object.assign(t)).initDraw()})},d.prototype.init=function(){var t,e,i,n,r=$('<div class=\"flowchart-father\" style=\"position: relative;overflow: auto; width: 100%; height: 100%\"></div');this.scrollParent=r,this.$parent=$('<div class=\"bgcontainer\"></div>'),this.canvas=$('<canvas class=\"flowchart-canvas\" ></canvas'),this.canvas.width=this.width,this.canvas.height=this.height,this.$wraper.append(this.scrollParent),this.showNodesWraper&&(this.$nodesWraper=$('<div class=\"nodes\"><span class=\"all-nodes\">总节点数：<span class=\"J-allNodes\"></span></span><span class=\"connected-nodes\">已连接节点数：<span class=\"J-connectedNodes\"></span></span></div>'),this.scrollParent.append(this.$nodesWraper),this.allNodesEle=this.scrollParent.find(\".J-allNodes\"),this.connectNodesEle=this.scrollParent.find(\".J-connectedNodes\")),this.$parent.append(this.canvas),this.scrollParent.append(this.$parent),this.ctx=this.canvas[0].getContext(\"2d\"),this.originX=this.scrollParent.offset().left,this.originY=this.scrollParent.offset().top,t=this.canvas,e=this.width,i=this.height,n=this.ratio,t.css({width:e,height:i}),t.attr({width:e*n,height:i*n});var o=this,s=$('<i class=\"'+this.deleteIcon+' delete-line\"></i>');s.widthValue=23,s.on(\"click\",function(t){o.deleteFocusLine()}),s.css({display:\"none\"}),this.$copyMove=$('<div id=\"copyMove\">1</div>'),this.scrollParent.append(s),this.scrollParent.append(this.$copyMove),this.$deLineIcon=s},d.prototype.initEvent=function(){var t=this;this.onLineBind=this.onLine.bind(this),this.onLineClickBind=this.onLineClick.bind(this),this.deleteLineBind=this.deleteLineEv.bind(this),this.scrollParent.on(\"mousemove\",this.onLineBind),this.scrollParent.on(\"click\",this.onLineClickBind),$(\"body\").on(\"keyup\",this.deleteLineBind),$(window).on(\"resize\",function(){t.originX=t.scrollParent.offset().left,t.originY=t.scrollParent.offset().top,t.lines.forEach(function(e){e.originX=t.originX,e.originY=t.originY}),this.flowchart.scrollParent.widthValue=this.flowchart.scrollParent.width(),this.flowchart.scrollParent.heightValue=this.flowchart.scrollParent.height()}),this.scrollParent.on(\"dragenter\",function(e){if(e.preventDefault(),t.creatingModule&&t.creatingModule.feType&&!t.creatingModule.moveStart){var i=t.scrollDistance(),n=e.pageX-t.originX+i.scrollLeft,r=e.pageY-t.originY+i.scrollTop;t.creatingModule=t.createRealModule(Object.assign(t.creatingModule,{x:n,y:r,toCenter:!0}),!1),t.creatingModule.moveStart(e,\"center\"),e.originalEvent.dataTransfer.dropEffect=\"move\"}}),this.scrollParent.on(\"dragover\",function(e){e.preventDefault(),t.creatingModule&&t.creatingModule.moveDrag&&(t.creatingModule.moveDrag(e),e.originalEvent.dataTransfer.dropEffect=\"move\")}),this.scrollParent.on(\"drop\",function(e){if(e.preventDefault(),t.creatingModule&&t.creatingModule.moveEnd){t.creatingModule.moveEnd(e);var i=Object.assign({},t.creatingModule);delete i.feId,delete i.$title,delete i.$icon,delete i.$content,delete i.toCenter,t.creatingModule.children&&t.creatingModule.children.map(function(t){return t.isDefaultBranch?Object.assign({},t):(delete t.feId,delete t.$title,delete t.$icon,Object.assign({},t))});var n=t.createRealModule(i);t.creatingModule.destroy(),t.creatingModule=null,n.children&&n.children.length&&n.children.forEach(function(e){t.modules.push(e)}),t.showNodes()}}),$(\"body\").on(\"dragend\",function(e){t.creatingModule&&(t.creatingModule.moveEnd&&t.creatingModule.moveEnd(e),t.creatingModule.destroy&&t.creatingModule.destroy(),t.creatingModule=null)})},d.prototype.deleteLine=function(t){if(t){((this.modules||[]).find(function(e){return e.feId==t.start.feId})||{}).feNextId=null,this.lines=this.lines.filter(function(e={}){return e.feId&&t.feId!=e.feId});var e=t.end&&t.end.feId;this.lines.find(function(t={}){return t.end&&e==t.end.feId});$(\"#\"+t.start.feId+\">.title-wraper>.dragableRect.start\").removeClass(\"connected\"),this.drawLines()}},d.prototype.deleteRelaLines=function(t,e=[]){var i=[t],n=[],r=this;e.forEach(function(t){return i.push(t.feId)}),i.forEach(function(t){n=n.concat(r.lines.filter(function(e){return e.start.feId==t||e.end.feId==t}))}),n.forEach(function(t){return r.deleteLine(t)})},d.prototype.onLine=function(t){t=t.originalEvent;var e=this.scrollDistance(),i=this,n=t.pageX-this.originX+e.scrollLeft,r=t.pageY-this.originY+e.scrollTop;this.scrollParent.css(\"cursor\",\"default\"),$(\".basemodule:hover\").css(\"cursor\",\"move\"),this.lines.forEach(function(e){e.isOnline(n,r)&&($(t.target).parents().hasClass(\"basemodule\")&&$(\".basemodule:hover\").css(\"cursor\",\"pointer\"),i.scrollParent.css(\"cursor\",\"pointer\"))})},d.prototype.onLineClick=function(t){t=t.originalEvent;var e=this.scrollDistance(),i=t.pageX-this.originX+e.scrollLeft,n=t.pageY-this.originY+e.scrollTop;this.cancelFocusLine(),this.clickLineOnModule=!1;var r=this.lines.find(function(t){return t.isOnline(i,n)});r?($(t.target).parents().hasClass(\"basemodule\")&&(this.clickLineOnModule=!0),r.focus=!0,r.lineWidth=3,this.showDelteLineIcon(t,e,r)):this.$deLineIcon.hide(),this.drawLines()},d.prototype.cancelFocusLine=function(t){this.lines.forEach(function(t){t.focus=!1,t.lineWidth=1}),t&&(this.drawLines(),this.$deLineIcon.hide())},d.prototype.showDelteLineIcon=function(t,e,i){var n,r,o=this.$deLineIcon.widthValue+3,s=(this.width,this.height,{x:-100,y:-100}),a={x:t.pageX-this.originX+e.scrollLeft,y:t.pageY-this.originY+e.scrollTop};if(i.sx===i.ex)a.x=i.ex,s.x=a.x-8-o,s.y=a.y,this.inCanvas(s,o,o)||(s.x=a.x-8);else if(i.sy===i.ey)a.y=i.ey,s.x=a.x,s.y=a.y-8-o,this.inCanvas(s,o,o)||(s.y=a.y+8);else{n=-(i.ex-i.sx)/(i.ey-i.sy),r=a.y-n*a.x;var h=this.getLinePoints(n,r,a,8);s=h.point1,h.point1.x<a.x&&(s.x=s.x-o),h.point1.y<a.y&&(s.y=s.y-o),this.inCanvas(s,o,o)||(s=h.point2),h.x<a.x&&(s.x=s.x-o),h.y<a.y&&(s.y=s.y-o)}this.$deLineIcon.css({display:\"block\",left:s.x+\"px\",top:s.y+\"px\"})},d.prototype.getLinePoints=function(t,e,i,n){var r=t*t+1,o=2*((e-i.y)*t-i.x),s=Math.pow(e-i.y,2)+Math.pow(i.x,2)-Math.pow(n,2),a=(-o-Math.sqrt(Math.pow(o,2)-4*r*s))/(2*r),h=a*t+e,l=(-o+Math.sqrt(Math.pow(o,2)-4*r*s))/(2*r);return{point1:{x:a,y:h},point2:{x:l,y:l*t+e}}},d.prototype.inCanvas=function(t,e,i){return 0<t.x&&t.x+e<this.width&&0<t.y&&t.y+i<this.height},d.prototype.inScrollParent=function(t,e){var i=this.scrollParent.offsetValue||this.scrollParent.offset(),n=this.scrollParent.widthValue||this.scrollParent.width(),r=this.scrollParent.heightValue||this.scrollParent.height();return this.scrollParent.offsetValue=i,this.scrollParent.widthValue=n,this.scrollParent.heightValue=r,e=e||0,i.left+e<t.x&&t.x<i.left+n-e&&i.top+e<t.y&&t.y<i.top+r-e},d.prototype.deleteLineEv=function(t){\"Backspace\"==t.key&&this.deleteFocusLine()},d.prototype.deleteFocusLine=function(t){var e=this.lines.find(function(t){return t.focus});this.deleteLine(e),this.$deLineIcon.hide(),this.showNodes()},d.prototype.drawLines=function(t){var e=this.ratio,i=this;this.ctx.clearRect(0,0,this.width*e,this.height*e),t=t||this.scrollDistance(),this.ctx.strokeStyle=this.themeColor,this.lines&&this.lines.forEach(function(t){i.ctx.beginPath(),t.focus?i.ctx.lineWidth=t.lineWidth*e:i.ctx.lineWidth=1*e,i.ctx.moveTo(t.sx*e,t.sy*e),i.ctx.lineTo(t.ex*e,t.ey*e),i.ctx.closePath(),i.ctx.stroke()})},d.prototype.createModule=function(t){if(t.isDragCreate=t.isDragCreate||!1,!t.isDragCreate){var e=this.createRealModule(t,!0);return this.showNodes(),e}this.creatingModule=Object.assign(t,{originX:this.originX,originY:this.originY,flowchart:this,feType:t.feType}),this.creatingModule},d.prototype.createRealModule=function(t,e=!0){var i=null,n=t.feType||\"normal\";if(\"normal\"==n)Object.assign(t,{originX:this.originX,originY:this.originY,flowchart:this,feType:n}),(i=new a(t)).init();else if(\"branchmodule\"==n)Object.assign(t,{originX:this.originX,originY:this.originY,flowchart:this,feType:n}),(i=new h(t)).initDraw();else if(\"branch\"==n&&t.feParentId){var r=this.modules&&this.modules.find(function(e){return e.feId&&e.feId==t.feParentId});r&&\"function\"==typeof r.addBranch&&(i=r.addBranch(t)).initDraw()}else\"specialBranch\"==n&&(Object.assign(t,{originX:this.originX,originY:this.originY,flowchart:this,feType:n}),(i=new c(t)).initDraw());return i&&(i.drawLines=this.drawLines.bind(this),i.deleteRelaLines=this.deleteRelaLines.bind(this)),e&&i&&this.modules.push(i),i},d.prototype.updateModule=function(t){this.modules.find(function(e){return e.feId===t.feId}).update(t)},d.prototype.removeChildModule=function(t,e){this.modules.find(function(e){return e.feId===t}).removeChild(e),this.showNodes()},d.prototype.removeChildren=function(t){this.modules.find(function(e){return e.feId===t}).removeChildren(),this.showNodes()},d.prototype.createChildren=function(t,e=[]){var i=this.modules.find(function(e){return e.feId===t}),n=this,r=this.scrollDistance();e.forEach(function(t){var e=i.addBranch(t);e.initDraw(),n.moduleLineRestore(e,r),n.modules.push(e)}),n.showNodes(),this.drawLines()},d.prototype.scrollDistance=function(){return{scrollLeft:this.scrollParent.scrollLeft()||0,scrollTop:this.scrollParent.scrollTop()||0}},d.prototype.destroy=function(){this.scrollParent.off(\"mousemove\",this.onLineBind),this.scrollParent.off(\"click\",this.onLineClickBind),$(\"body\").off(\"keyup\",this.deleteLineBind)},d.prototype.getAllNodes=function(){return(this.scrollParent.find(\".dragableRect\")||[]).length},d.prototype.getConnectedNodes=function(){return(this.scrollParent.find(\".dragableRect.connected\")||[]).length},d.prototype.showNodes=function(){var t=this.getAllNodes(),e=this.getConnectedNodes();this.allNodesEle.html(t),this.connectNodesEle.html(e)},d.prototype.save=function(){var t=[];return this.modules.forEach(function(e){var i={feId:e.feId,feNextId:e.feNextId,feParentId:e.feParentId,text:e.text,type:e.type,data:e.data,viewInfo:JSON.stringify({feType:e.feType,feId:e.feId,feNextId:e.feNextId,feParentId:e.feParentId,titleIcon:e.titleIcon,x:e.x,y:e.y,isFirst:e.isFirst,isLast:e.isLast,canbeStart:e.canbeStart,canbeEnd:e.canbeEnd,hasDelete:e.hasDelete,hasSetting:e.hasSetting,settingCallback:e.settingCallback,isDefaultBranch:e.isDefaultBranch})};t.push(i)}),localStorage.setItem(\"modules\",JSON.stringify(t)),t},d.prototype.restore=function(t=[]){if(!t.length){if(!localStorage.getItem(\"modules\"))return;t=JSON.parse(localStorage.getItem(\"modules\"))}t.map(function(t){return Object.assign(t,JSON.parse(t.viewInfo))});var e=this.scrollDistance(),i=this,n=t.filter(function(t){return\"branch\"===t.feType});t.filter(function(t){return\"branch\"!==t.feType}).forEach(function(t){i.moduleRestore(t)}),n.forEach(function(t){i.moduleRestore(t)}),this.lines.forEach(function(t){t.styleEndPonit(),t.lineCoordinate(e,i.rectWidth)}),this.drawLines(),this.showNodes()},d.prototype.moduleRestore=function(t){var e=this.createRealModule(Object.assign(t));this.moduleLineRestore(e)},d.prototype.moduleLineRestore=function(t,e){if(t.feNextId){var i=this.lineRandomIds.shift(0);i||console.log(\"线段超出最大值1000\");var n=\"line\"+(new Date).getTime()+i,o=new r({originX:this.originX,originY:this.originY,feId:n});o.setPoint({start:{feId:t.feId},end:{feId:t.feNextId}}),e&&o.lineCoordinate(e,this.rectWidth),this.lines.push(o)}};var f=d;i(0);window.Flowchart=f;e.default=f}]);","extractedComments":[]}